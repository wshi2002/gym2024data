---
title: "**Case Study 2: Paris 2024 Team USA Olympics Gymnastics Team**"
author: "Aimi Wen, Katie Nash, Nidhi Dhupati, Wendy Shi"
output: 
  pdf_document:
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r, include = FALSE}
# load in libraries
package_list <- c("tidyverse", "vroom", "stringr", "dplyr", "ggsci", "gridExtra")

# load in packages
for (package_name in package_list) {
  if (!requireNamespace(package_name, quietly = TRUE)) {
    install.packages(package_name)
  }
  library(package_name, character.only = TRUE)
}

# load in data
df <- vroom("cleandata/data_2022_2023.csv")


```

```{r, include = FALSE}
# Clean up names to make sure there is unique name for each athlete.
# taking the first 'word' of the names to simplify
df <- df%>%
  mutate(first_name_only = word(FirstName, 1)) %>%
  mutate(last_name_only = word(LastName, 1))

# standardizing countries. Ex know Scotland and Wales all compete with England as Great Britain.
df_c <- df %>%
  mutate(
    clean_country = case_when(Country == "SCO" ~ "GBR", 
                              Country == "ENG" ~ "GBR", 
                              Country == "WAL" ~ "GBR",
                              Country == "SIN" ~ "SIG", 
                              Country == "GE1" ~ "GER", 
                              Country == "GE2" ~ "GER", 
                              Country == "NIR" ~ "GBR",
                              Country == "IOM" ~ "GBR", 
                              Country == "PUR" ~ "USA",
                              TRUE ~ Country
      
    )
  )

# Simplifying accents in names and dashes
replace_letters <- function(name){
  name <- gsub("Ö", "OE", name)
  name <- gsub("Ü", "U", name)
  name <- gsub("Ø", "O", name)
  name <- sub("-.*", "", name)
  name <- gsub("Ä", "AE", name)
  return(name)
}

standardize <- function(name){
  name <- iconv(name, "UTF-8", "ASCII//TRANSLIT")
  return (name)
}

# Applying accent cleaning function to dataframe's name columns.
df_c$first_name_only <- lapply(df_c$first_name_only, replace_letters)
df_c$last_name_only <- lapply(df_c$last_name_only, replace_letters)

df_c$first_name_only <- lapply(df_c$first_name_only, standardize)
df_c$last_name_only <- lapply(df_c$last_name_only, standardize) 


# mutate to create name variable comprising of both first and last name
df_c <- df_c %>%
  mutate(name = paste(first_name_only, last_name_only))

# Separating into two dataset of men and women's gymnastics
df_men_c <- df_c%>%
  filter(Gender == "m")

df_women_c <- df_c%>%
  filter(Gender == "w")

  
```

```{r, include = FALSE}
# Manual cleaning done on name for women's data
df_women_c <- df_women_c %>%
  mutate(
    clean_name = case_when(
      name == "Anna KONIG" ~ "Anna KOENIG",
      name == "Aberdeen O" ~ "Aberdeen O'DRISCOL", 
      name == "Christina KIOSO" ~ "Christina VASILOPOULOU",
      name == "Korkem YEROBSSYNKYZY" ~ "Korkem YERBOSSYNKYZY",
      name == "Larasati REGGANIS" ~ "Larasati RENGGANIS", 
      name == "Liu MAI" ~ "Mai LIU" ,
      name == "Melanie DE" ~ "Melanie DE JESUS", 
      name == "Melanie JESUS" ~ "Melanie DE JESUS", 
      name == "Milka ELPITIYA" ~ "Milka GEHANI", 
      name == "NA ELPITIYA" ~ "Milka GEHANI", 
      name == "Nika KUKULJAN" ~ "Nika FRLETA", 
      name == "Olivia MAFES" ~ "Olivia Kelly", 
      name == "Ruby EVAN" ~ "Ruby EVANS", 
      name == "Sasiwimion MUEANGPHUAN" ~ "Sasiwimon MUEANGPHUAN", 
      name == "Shade OORSCHOT" ~ "Shade VAN OORSCHOT",
      name == "Shade VAN" ~ "Shade VAN OORSCHOT", 
      name == "Vera VAN" ~ "Vera VAN POL", 
      name == "Vera POL"  ~ "Vera VAN POL", 
      name == "Wong VANESSA" ~ "Vanessa WONG", 
      name == "Zeina SHARAF" ~ "Zeina IBRAHIM", 
      name == "NA JESUS" ~ "Melanie DE JESUS",
      TRUE ~ name
    )
  )

# Manual cleaning done on country specifications for women's data
df_women_c <- df_women_c %>%
  mutate(
    clean_country = ifelse(clean_name == "Teja BELAK", "SLO", clean_country), 
    clean_country = ifelse(clean_name == "Naveen DARIES", "RSA", clean_country), 
    clean_country = ifelse(clean_name == "Madeleine MARSHALL", "NZL", clean_country)
  )

df_women_c <- df_women_c %>%
  filter(!is.na(first_name_only))

numeric_columns <- sapply(df_women_c, is.numeric)
df_women_c[numeric_columns][is.na(df_women_c[numeric_columns])] <- 0
```

```{r , include = FALSE}
# Manual cleaning done on name for men's data
df_men_c <- df_men_c %>%
  mutate(
    clean_name = case_when(
      name == "Mc ATEER" ~ "Ewan MCATEER",
      name == "Ewan MC" ~ "Ewan MCATEER", 
      name == "Mc CLENAGHAN" ~ "Rhys MCCLENAGHAN",
      name == "Rhys MC" ~ "Rhys MCCLENAGHAN",
      name == "Samual DICK" ~ "Samuel DICK",
      name == "William FU" ~ "William FUALLEN",
      name == "Jermain GRUNBERG" ~ "Jermain GRUENBERG", 
      name == "Rakah HARITHI" ~ "Rakan HARITHI",
      name == "Vinzenz HOCK" ~ "Vinzenz HOECK",
      name == "VInzenz HOECK" ~ "Vinzenz HOECK",
      name == "Mohamad KHALIL" ~ "Mohamed KHALIL",
      name == "Severin KRANZLMULLER" ~ "Severin KRANZLMUELLER",
      name == "NA KUMARASINGHEGE" ~ "Hansha KUMARASINGHEGE",
      name == "Manuel MARTINEZ" ~ "Jose MARTINEZ",
      name == "Felipe MARTINEZ" ~ "Andres MARTINEZ",
      name == "Clay MASON" ~ "Clay MASONSTEPHENS",
      name == "Dimitrijs MICKEVICS" ~ "Dmitrijs MICKEVICS",
      name == "Dmitry PATANIN" ~ "Dmitriy PATANIN",
      name == "NA SOUZA" ~ "Caio SOUZA",
      name == "Jann TIMBANG" ~ "Jan TIMBANG",
      name == "Kim VANSTROM" ~ "Kim VANSTROEM",
      name == "Sam ZAKUTNEY" ~ "Samuel ZAKUTNEY",
      TRUE ~ name
    )
  )

# Manual cleaning done on country specifications for men's data
df_men_c <- df_men_c %>%
  mutate(
    clean_country = ifelse(clean_name == "Ewan MCATEER", "IRL", clean_country), 
    clean_country = ifelse(clean_name == "Rhys MCCLENAGHAN", "IRL", clean_country), 
    clean_country = ifelse(clean_name == "Dominick CUNNINGHAM", "IRL", clean_country),
    clean_country = ifelse(clean_name == "Eamon MONTGOMERY", "IRL", clean_country),
    clean_country = ifelse(clean_name == "NIkita SIMONOV", "AZE", clean_country)
  )

df_men_c <- df_men_c %>%
  filter(!is.na(first_name_only))

numeric_columns <- sapply(df_men_c, is.numeric)
df_men_c[numeric_columns][is.na(df_men_c[numeric_columns])] <- 0

```

```{r, include = FALSE}
df_men_names <- df_men_c %>%
  distinct(last_name_only, first_name_only, clean_country, name)

```

```{r ordering-competitions-women, include = FALSE}

unique(df_women_c$Competition)

df_women_c <- df_women_c %>%
  mutate(competition_number = case_when(
    Competition == "2022 Cottbus World Cup" ~ "1",
    Competition == "2022 Winter Cup" ~ "2",
    Competition == "2022 Doha World Cup" ~ "3",
    Competition == "2022 Cairo World Cup" ~ "4",
    Competition == "2022 British Gymnastics Championships" ~ "5",
    Competition == "2022 Varna World Challenge Cup" ~ "6",
    Competition == "2022 Baku World Cup" ~ "7",
    Competition == "2022 Osijek World Challenge Cup" ~ "8",
    Competition == "2022 9th Senior Artistic Gymnastics Asian Championships" ~ "9",
    Competition == "2022 Koper World Challenge Cup" ~ "10",
    Competition == "2022 U.S. Classic" ~ "11",
    Competition == "BIRMINGHAM 2022 Commonwealth Games" ~ "12",
    Competition == "2022 Senior European Championships" ~ "13",
    Competition == "2022 U.S. Championships" ~ "14",
    Competition == "2022 Paris World Challenge Cup" ~ "15",
    Competition == "2022 Szombathely World Challenge Cup" ~ "16",
    Competition == "2022 Mersin World Challenge Cup" ~ "17",
    Competition == "2022 51st FIG Artistic Gymnastics World Championships" ~ "18",
    Competition == "2023 Cottbus World Cup" ~ "19",
    Competition == "2023 Winter Cup" ~ "20",
    Competition == "2023 Doha World Cup" ~ "21",
    Competition == "2023 Baku World Cup" ~ "22",
    Competition == "EnBW DTB Pokal Team Challenge 2023" ~ "23",
    Competition == "2023 British Gymnastics Championships" ~ "24",
    Competition == "2023 Senior European Championships" ~ "25",
    Competition == "2023 Cairo World Cup" ~ "26",
    Competition == "2023 Varna World Challenge Cup" ~ "27",
    Competition == "2023 Artistic Gymnastics Senior Pan American Championships" ~ "28",
    Competition == "2023 Tel Aviv World Challenge Cup" ~ "29",
    Competition == "2023 Osijek World Challenge Cup" ~ "30",
    Competition == "2023 10th Senior Artistic Gymnastics Asian Championships" ~ "31",
    Competition == "2023 Central American and Caribbean Games" ~ "32",
    Competition == "2023 FISU World University Games" ~ "33",
    Competition == "2023 Core Hydration Classic" ~ "34",
    Competition == "2023 U.S. Championships" ~ "35",
    Competition == "2023 52nd FIG Artistic Gymnastics World Championships" ~ "36",
    TRUE ~ "Other"
  ))

df_women_c = df_women_c %>%
  mutate(competition_number = as.numeric(competition_number))

```

```{r categorizing-competitions-women, include = FALSE}

df_women_c <- df_women_c %>%
  mutate(competition_scope = case_when(
    Competition == "2022 Cottbus World Cup" ~ "World",
    Competition == "2022 Winter Cup" ~ "USA",
    Competition == "2022 Doha World Cup" ~ "World",
    Competition == "2022 Cairo World Cup" ~ "World",
    Competition == "2022 British Gymnastics Championships" ~ "non-USA",
    Competition == "2022 Varna World Challenge Cup" ~ "World",
    Competition == "2022 Baku World Cup" ~ "World",
    Competition == "2022 Osijek World Challenge Cup" ~ "World",
    Competition == "2022 9th Senior Artistic Gymnastics Asian Championships" ~ "non-USA",
    Competition == "2022 Koper World Challenge Cup" ~ "World",
    Competition == "2022 U.S. Classic" ~ "USA",
    Competition == "BIRMINGHAM 2022 Commonwealth Games" ~ "non-USA",
    Competition == "2022 Senior European Championships" ~ "non-USA",
    Competition == "2022 U.S. Championships" ~ "USA",
    Competition == "2022 Paris World Challenge Cup" ~ "World",
    Competition == "2022 Szombathely World Challenge Cup" ~ "World",
    Competition == "2022 Mersin World Challenge Cup" ~ "World",
    Competition == "2022 51st FIG Artistic Gymnastics World Championships" ~ "World",
    Competition == "2023 Cottbus World Cup" ~ "World",
    Competition == "2023 Winter Cup" ~ "USA",
    Competition == "2023 Doha World Cup" ~ "World",
    Competition == "2023 Baku World Cup" ~ "World",
    Competition == "EnBW DTB Pokal Team Challenge 2023" ~ "World",
    Competition == "2023 British Gymnastics Championships" ~ "non-USA",
    Competition == "2023 Senior European Championships" ~ "non-USA",
    Competition == "2023 Cairo World Cup" ~ "World",
    Competition == "2023 Varna World Challenge Cup" ~ "World",
    Competition == "2023 Artistic Gymnastics Senior Pan American Championships" ~ "USA",
    Competition == "2023 Tel Aviv World Challenge Cup" ~ "World",
    Competition == "2023 Osijek World Challenge Cup" ~ "World",
    Competition == "2023 10th Senior Artistic Gymnastics Asian Championships" ~ "non-USA",
    Competition == "2023 Central American and Caribbean Games" ~ "non-USA",
    Competition == "2023 FISU World University Games" ~ "USA",
    Competition == "2023 Core Hydration Classic" ~ "USA",
    Competition == "2023 U.S. Championships" ~ "USA",
    Competition == "2023 52nd FIG Artistic Gymnastics World Championships" ~ "World",
    TRUE ~ "Other"
  ))

```

```{r ordering-competitions-men, include = FALSE}

df_men_c <- df_men_c %>%
  mutate(competition_number = case_when(
    Competition == "2022 Cottbus World Cup" ~ "1",
    Competition == "2022 Winter Cup" ~ "2",
    Competition == "2022 Doha World Cup" ~ "3",
    Competition == "2022 Cairo World Cup" ~ "4",
    Competition == "2022 British Gymnastics Championships" ~ "5",
    Competition == "2022 Varna World Challenge Cup" ~ "6",
    Competition == "2022 Baku World Cup" ~ "7",
    Competition == "2022 Osijek World Challenge Cup" ~ "8",
    Competition == "2022 9th Senior Artistic Gymnastics Asian Championships" ~ "9",
    Competition == "2022 Koper World Challenge Cup" ~ "10",
    Competition == "2022 U.S. Classic" ~ "11",
    Competition == "BIRMINGHAM 2022 Commonwealth Games" ~ "12",
    Competition == "2022 Senior European Championships" ~ "13",
    Competition == "2022 U.S. Championships" ~ "14",
    Competition == "2022 Paris World Challenge Cup" ~ "15",
    Competition == "2022 Szombathely World Challenge Cup" ~ "16",
    Competition == "2022 Mersin World Challenge Cup" ~ "17",
    Competition == "2022 51st FIG Artistic Gymnastics World Championships" ~ "18",
    Competition == "2023 Cottbus World Cup" ~ "19",
    Competition == "2023 Winter Cup" ~ "20",
    Competition == "2023 Doha World Cup" ~ "21",
    Competition == "2023 Baku World Cup" ~ "22",
    Competition == "EnBW DTB Pokal Team Challenge 2023" ~ "23",
    Competition == "2023 British Gymnastics Championships" ~ "24",
    Competition == "2023 Senior European Championships" ~ "25",
    Competition == "2023 Cairo World Cup" ~ "26",
    Competition == "Oceania Continental Championships 2023" ~ "27",
    Competition == "2023 Varna World Challenge Cup" ~ "28",
    Competition == "2023 Artistic Gymnastics Senior Pan American Championships" ~ "29",
    Competition == "2023 Tel Aviv World Challenge Cup" ~ "30",
    Competition == "2023 Osijek World Challenge Cup" ~ "31",
    Competition == "2023 10th Senior Artistic Gymnastics Asian Championships" ~ "32",
    Competition == "2023 Central American and Caribbean Games" ~ "33",
    Competition == "2023 FISU World University Games" ~ "34",
    Competition == "2023 Core Hydration Classic" ~ "35",
    Competition == "2023 U.S. Championships" ~ "36",
    Competition == "2023 52nd FIG Artistic Gymnastics World Championships" ~ "37",
    TRUE ~ "Other"
  ))

df_men_c = df_men_c %>%
  mutate(competition_number = as.numeric(competition_number))

```

```{r categorizing-competitions-men, include = FALSE}

df_men_c <- df_men_c %>%
  mutate(competition_scope = case_when(
    Competition == "2022 Cottbus World Cup" ~ "World",
    Competition == "2022 Winter Cup" ~ "USA",
    Competition == "2022 Doha World Cup" ~ "World",
    Competition == "2022 Cairo World Cup" ~ "World",
    Competition == "2022 British Gymnastics Championships" ~ "non-USA",
    Competition == "2022 Varna World Challenge Cup" ~ "World",
    Competition == "2022 Baku World Cup" ~ "World",
    Competition == "2022 Osijek World Challenge Cup" ~ "World",
    Competition == "2022 9th Senior Artistic Gymnastics Asian Championships" ~ "non-USA",
    Competition == "2022 Koper World Challenge Cup" ~ "World",
    Competition == "2022 U.S. Classic" ~ "USA",
    Competition == "BIRMINGHAM 2022 Commonwealth Games" ~ "non-USA",
    Competition == "2022 Senior European Championships" ~ "non-USA",
    Competition == "2022 U.S. Championships" ~ "USA",
    Competition == "2022 Paris World Challenge Cup" ~ "World",
    Competition == "2022 Szombathely World Challenge Cup" ~ "World",
    Competition == "2022 Mersin World Challenge Cup" ~ "World",
    Competition == "2022 51st FIG Artistic Gymnastics World Championships" ~ "World",
    Competition == "2023 Cottbus World Cup" ~ "World",
    Competition == "2023 Winter Cup" ~ "USA",
    Competition == "2023 Doha World Cup" ~ "World",
    Competition == "2023 Baku World Cup" ~ "World",
    Competition == "EnBW DTB Pokal Team Challenge 2023" ~ "World",
    Competition == "2023 British Gymnastics Championships" ~ "non-USA",
    Competition == "2023 Senior European Championships" ~ "non-USA",
    Competition == "2023 Cairo World Cup" ~ "World",
    Competition == "Oceania Continental Championships 2023" ~ "non-USA",
    Competition == "2023 Varna World Challenge Cup" ~ "World",
    Competition == "2023 Artistic Gymnastics Senior Pan American Championships" ~ "USA",
    Competition == "2023 Tel Aviv World Challenge Cup" ~ "World",
    Competition == "2023 Osijek World Challenge Cup" ~ "World",
    Competition == "2023 10th Senior Artistic Gymnastics Asian Championships" ~ "non-USA",
    Competition == "2023 Central American and Caribbean Games" ~ "non-USA",
    Competition == "2023 FISU World University Games" ~ "USA",
    Competition == "2023 Core Hydration Classic" ~ "USA",
    Competition == "2023 U.S. Championships" ~ "USA",
    Competition == "2023 52nd FIG Artistic Gymnastics World Championships" ~ "World",
    TRUE ~ "Other"
  ))

```


# Introduction


### Background Information

The Olympic Games are an international multi-sport event held every four years, and are largely considered to be the most prestigious sporting competition in the world. These Games are therefore a popular spectator event across the world, with an average viewership of more than 15 million people in past years [1].
The 2024 Olympic Games will be held in Paris, France, and will include both a Men’s and Women’s Artistic Gymnastics event. Winning a medal in an Olympic gymnastics event is an honor for both the individual athlete and for the country that athlete represents; the medal brings a sense of national pride to citizens across the country and promotes the global recognition of the winning country. The USA is known for its men and women gymnastics teams, which have consistently earned medals in past Olympic games. Because of the high honor and importance of upholding the legacy of the United States in these competitions, it is important to carefully select the men and women that will represent our country as Team USA. The importance of and interest surrounding the Olympics provides a rich foundation for analytics and statistical interpretations of the athletes in the competitions, as well as predictions about who will represent Team USA in the many Olympic sports. There have already been analyses, published in major news outlets, about who Team USA will consist of for non-gymnastics sports in 2024 [2]. The objective of this project is to extend this analysis to the Artistic Gymnastics events, and to select the 5 athletes for each of the men’s and women’s events that will optimize performance for Team USA.

The format of the Olympic Artistic Gymnastics event includes a qualifying round and final round. Scores from qualifying rounds do not impact medal determinations, but rather decide which athletes advance to the finals. The final round, which is what determines medal placements, consists of team all-around, individual all-around, and individual apparatus events. Men’s opportunities for medals are: 1) team all-around, 2) individual all-around, 3) floor exercise, 4) pommel horse, 5) still rings, 6) vault, 7) parallel bars, and 8) high bar. Women’s opportunities for medals are: 1) team all-around, 2) individual all-around, 3) vault, 4) uneven bars, 5) balance beam, and 6) floor exercise. The athletes representing Team USA will compete in a pool of 96 men and 96 women, which will include teams of five from other countries as well as the option for individual entries for countries without full team qualifications.

Our hypothesis is:

* Who are the 5 men and 5 women who can make Team USA achieve the highest level of success at the Paris 2024 Artistic Gymnastics Event?


### Data Description

Gymnastics competitions from 2017-2023 were included in the dataset. These competitions were split into two separate datasets by the seasons leading up to the 2021 Tokyo Games and the seasons leading up to the 2024 Paris Games (the 2022 and 2023 seasons). Competitions were included from around the globe, including world competitions, non-world competitions that included the United States as a competitor, and non-world competitions that did not include the United States as a competitor.
The competition data included scoring information, athlete names, athlete demographic information, and athlete scores. Each entry in the dataset is one event from one athlete, which includes the country affiliation of the athlete, the competition and competition location, the difficulty, execution, penalty, and overall scores, the apparatus that the athlete competed on, and their ranking.
Additionally, the countries who qualified as a team, which are the countries that will be allowed to compete in the Team All-Around event for the men’s and women’s Olympic events, were provided. 
The dataset we used for analysis was last synced with the central repository on November 2nd.

# Methodology

## Data Cleaning
From the original competition dataset, we standardized variables and added columns. We standardized each athlete’s name based on the first instance it appeared and created a column that included the full name of the athlete. We additionally made sure the country codes were consistent with International Olympic Committee Codes (for example, Scotland competes as part of the United Kingdom in the Olympics). We additionally separated the competition data into two datasets by men’s and women’s competitions, created a variable to track the order that the competitions occurred by their dates, and added a competition scope variable to aid with data visualizations and athlete selection in the analysis approach.

## Analysis Approach
In order to study which athletes could enable Team USA to achieve maximum success at the Paris Olympics, we decided to model possible Olympic scenarios by simulating the medal outcomes of different variations of Team USA competing with variations of teams from other countries.
Our metric of success was a weighted medal count: we assigned 3 points to a Gold medal, 2 points to a Silver medal, and 1 point to a Bronze medal. This reflects our belief in the relative prestige of each medal, and will allow the highest score to reflect our interpretation of the highest level of success.
We conducted a separate simulation process for the Men’s Artistic Gymnastics Event and the Women’s Artistic Gymnastics Event. Each simulation can be broken down into the following subsections: athlete selection, creating score distributions, team selection, Team All-Around event simulation, individual event simulation, and finding the top performing USA teams.

### Athlete Selection Criteria
We only included athletes who placed in the top 10 at a World competition or in the top 3 at a non-World competition in our hypothetical team combinations. This reflects an assumption that World competitions are more competitive than non-World competitions, and that each country would only select the highest level of top-performing athletes to represent their country in the Olympics.

### Creating Score Distributions
The next step is to simulate the score that each athlete receives on each apparatus. We created a score distribution for each athlete and apparatus that mimics the characteristics of the observed scores they received in past competitions, while adding noise and allowing for more score selection options than just the exact scores they have received in the past. We used the process of kernel density estimation (KDE), which provides a continuous representation of the score distribution. Mathematical details about the development of our KDEs is included in the appendix.
Although we are only simulating scores for the final rounds, since those are the medal-earning events, we decided to include athlete scores from qualification and final rounds in our creation of the KDEs.
Figure X confirms that the distribution of scores for qualification and final rounds are similar.
Additionally, we only created the KDEs based on total score for the athlete, instead of separating the scores by difficulty score, execution score, and penalty score. Since the total score is difficulty score + execution score - penalty score, it encompasses all of these sub-scores. Figure X additionally demonstrates that most penalty scores are near 0.



### Team Selection
In order to simulate Olympics outcomes, we had to select a team of five gymnasts for each qualifying country in the Olympics, for each simulation round. Because the Olympics has already released which countries have qualified, we used those countries to filter out athletes who did not belong to a qualifying country. For each qualifying country, we used weighted random sampling to select 5 gymnasts. Weighted random sampling was chosen rather than simple random sampling in order for the highest performing athletes to be sampled more often. The weights also biased selection toward “well-rounded” gymnasts, who have a high score on multiple apparatuses, rather than “specialized” gymnasts. We made the assumption that all-around athletes have the potential to compete in multiple medal events, and that medaling the individual all-around event can bring more media coverage and prestige to the winning country than winning an individual apparatus event.
Mathematical details about the weighting process are included in the appendix.

### Team All-Around Simulation
To simulate the team all-around competition, three gymnasts would need to be selected to compete for each apparatus from the five gymnasts on each team. After selecting the five athletes for each country’s team, we simulated how each athlete would score for each individual event by randomly sampling 1 score from the appropriate athlete and apparatus KDE score distribution. Then, for each apparatus, we selected the athletes with the 3 highest scores to compete in the Team All-Around.

Once every qualifying country had three athletes selected for each apparatus, the scores for the actual event with these athletes was simulated. Then, the scores for all apparatuses were summed by country to create the final scores for the Team All-Around event. The top 3 teams were given the appropriate medal counts.

### Individual Events Simulation
Unlike the Team All-Around, individual events allow for athletes from countries that did not qualify as a team. Therefore, when simulating individual events, our dataset included five athletes that were randomly selected (via the weighted random selection process) for each qualifying country, as well as all of the athletes who passed our athlete selection criteria but did not belong to a qualifying country.
For each individual event and athlete, we randomly sampled one score from the appropriate athlete and apparatus KDE score density.
For individual events where multiple scores can be recorded (the individual all-around and vault events), we summed each score together to represent the final score for each event. The top 3 athletes for each event were given the appropriate medal counts.

### Finding the Top USA Teams
We ran 5000 simulations for the Men’s Artistic Gymnastics Event, and a separate 5000 simulations for the Women’s Artistic Gymnastics Event. Each simulation included a separate selection process for the five athletes who would represent the qualifying countries.
After running these simulations, we selected the one simulation where the USA scored the highest weighted medal count for each gender.
We selected the athletes selected in this highest-scoring round as Team USA. Then, to address potential variability in our results as well as address the limitation that Team USA may have just scored highly due to poor performance of other countries, we set these athletes as our Team USA. Then, we ran another 100 simulations, where we randomly selected the athletes in other qualifying countries but kept the same athletes in every simulation for the United States. From these simulations, we tracked how many times the United States had the highest weighted medal count of all countries.


# Results

```{r}
women_sims <- readRDS("~/gym2024data/simulations_Aimi.rds")
men_sims <- readRDS("~/gym2024data/simulations_m_katie.rds")
```



```{r, include = FALSE}
# top US simulations for men

USA_medals_m <- vector("list", length = 5000)

for (i in seq_along(USA_medals_m)) {
  summaryTeam <- men_sims[[i]]@teamSummary
  USA_medals_m[i] <- summaryTeam$total_medals[summaryTeam$clean_country == "USA"]
}

USA_medals_m = unlist(USA_medals_m)

top_indices <- order(USA_medals_m, decreasing = TRUE)[1:10]
top_indices

```

```{r, include = FALSE}

first_medals_m <- men_sims[[779]]@teamSummary
first_team_usa_m <- first_medals_m$athletes[first_medals_m$clean_country == "USA"]
```

```{r, include = FALSE}

# top US simulations for women

USA_medals_w <- vector("list", length = 5000)

for (i in seq_along(USA_medals_w)) {
  summaryTeam <- women_sims[[i]]@teamSummary
  USA_medals_w[i] <- summaryTeam$total_medals[summaryTeam$clean_country == "USA"]
}

USA_medals_w = unlist(USA_medals_w)

top_indices <- order(USA_medals_w, decreasing = TRUE)[1:10]
top_indices

```

```{r, include = FALSE}

first_medals_w <- women_sims[[3864]]@teamSummary
first_team_usa_w <- first_medals_w$athletes[first_medals_w$clean_country == "USA"]
first_medals_w
```

Of the 5000 simulations for both men and women, the simulation with the highest weighted medal score for the United States was taken as Team USA. The results of the simulated Olympics competitions, for both the Men’s and Women’s Artistic Gymnastics events, are included below.


```{=latex}

\newcommand{\highlight}[1]{\colorbox{yellow}{#1}}

\begin{table}[htbp]
  \caption{Men's Artistic Gymnastics - Best Simulated Outcome for Team USA}
  \medskip
  \small
  \begin{tabular}{l|l|l|l}
    \multicolumn{1}{c}{\textbf{Event}} & \multicolumn{1}{c}{\textbf{Gold}} & \multicolumn{1}{c}{\textbf{Silver}} & \multicolumn{1}{c}{\textbf{Bronze}} \\
    \hline
    Team All-Around & \highlight{USA} & China & Switzerland \\
    \hline
    Individual All-Around & \highlight{USA (Brody Malone)} & China (Boheng Zhang) & China (Wei Sun) \\
    \hline
    Vault & Armenia (Artur Davtyan) & Philippines (Carlos Yulo) & Great Britain (Luke Whitehouse) \\
    \hline
    Still Rings & \highlight{USA (Javier Alfonso)} & \highlight{USA (Brody Malone)} & Italy (Salvatore Maresca) \\
    \hline
    Pommel Horse & Chinese Taipei (Chih Lee) & Kazakhstan (Nariman Kurbanov) & Uzbekistan (Abdulla Azimov) \\
    \hline
    Parallel Bars & China (Jingyuan Zou) & \highlight{USA (Curran Phillips)} & Switzerland (Noe Seifert) \\
     \hline
    High Bar & \highlight{USA (Frederick Richard)} & Kazakhstan (Ilyas Azizov) & \highlight{USA (Brody Malone)} \\
    \hline
    Floor Exercise & \highlight{USA (Brody Malone)} & Israel (Artem Dolgopyat) & India (Satyajit Mondal) \\

  \end{tabular}
  
  \label{tab:gymnastics_medals}
\end{table}

  \small
  \textbf{Team USA Athletes: Brody Malone, Javier Alfonso, Curran Phillips, Frederick Richard, Joshua Karnes} \\
  \textbf{Team USA Medal Count:} 8 \\
  \textbf{Team USA Weighted Medal Count:} 20 (where Gold = 3, Silver = 2, Bronze = 1) \\
  \textbf{Team USA Medal Breakdown:} 5 Gold, 2 Silver, 1 Bronze
```


```{=latex}

\begin{table}[htbp]
  \caption{Women's Artistic Gymnastics - Best Simulated Outcome for Team USA}
  \medskip
  \small
  \begin{tabular}{l|l|l|l}
    \multicolumn{1}{c}{\textbf{Event}} & \multicolumn{1}{c}{\textbf{Gold}} & \multicolumn{1}{c}{\textbf{Silver}} & \multicolumn{1}{c}{\textbf{Bronze}} \\
    \hline
    Team All-Around & \highlight{USA} & Brazil & China \\
    \hline
    Individual All-Around & \highlight{USA (Simone Biles)} & Brazil (Rebeca Andrade) & \highlight{USA (Konnor McClain)} \\
    \hline
    Balance Beam & \highlight{USA (Konnor McClain)} & \highlight{USA (Simone Biles)} & China (Qingying Zhang) \\
    \hline
    Vault & \highlight{USA (Jade Carey)} & \highlight{USA (Simone Biles)} & South Korea (Seojeong Yeo) \\
    \hline
    Floor Exercise & \highlight{USA (Simone Biles)} & \highlight{USA (Jade Carey)} & Brazil (Rebeca Andrade) \\
    \hline
    Uneven Bars & Algeria (Kaylia Nemour) & Russia (Viktoria Listunova) & \highlight{USA (Shilese Jones)} \\

  \end{tabular}
  
  \label{tab:gymnastics_medals}
\end{table}

  \small
  \textbf{Team USA Athletes: Simone Biles, Shilese Jones, Karis German, Konnor McClain, Jade Carey} \\
  \textbf{Team USA Medal Count:} 10 \\
  \textbf{Team USA Weighted Medal Count:} 23 (where Gold = 3, Silver = 2, Bronze = 1) \\
  \textbf{Team USA Medal Breakdown:} 5 Gold, 3 Silver, 2 Bronze
```


These tables show that, for both men’s and women’s events, the United States earns more medals than any other country.

Simone Biles, Shilese Jones, Karis German, Konnor McClain, and Jade Carey were selected as the women’s Team USA. All five of these athletes are proven to be highly accomplished [3]:

* Simone Biles is the most decorated gymnast in history
* Shilese Jones was part of the gold-winning team at the 2022 World Championships
* Karis German medaled in a floor exercise event at a qualifying event for the 2024 Olympics
* Konnor McClain is the 2022 U.S. National Champion
* Jade Carey represented Team USA in the Tokyo Olympic Games

Brody Malone, Javier Alfonso, Curran Phillips, Frederick Richard, and Joshua Karnes were selected as the men’s Team USA in the simulation where the USA has the highest weighted medal score. All five of these athletes are also proven to be highly accomplished [3]:

* Brody Malone is the 2021 and 2022 U.S. National All-Around Champion
* Javier Alfonso was part of the silver-winning team at the 2023 NCAA competition
* Curran Phillips is the 2023 Pan American Games team champion
* Frederick Richard is the 2023 World all-around bronze medalist
* Joshua Karnes is the 2023 Winter Cup bronze medalist in parallel bars

# Discussion

Plots to add, once we get final team:
average Score by apperatous per team USA athlete
performance over time

justify: use all scores not just quali and final

## Analysis

```{r}
w_team_usa <- filter(df_women_c, 
                     clean_name == "Simone BILES" |
                     clean_name == "Shilese JONES"|
                     clean_name == "Karis GERMAN"|
                     clean_name == "Konnor MCCLAIN"|
                     clean_name == "Jade CAREY")

w_team_usa <- w_team_usa %>% mutate(clean_name = case_when (
  clean_name == 'Simone BILES' ~ 'Simone Biles',
  clean_name == 'Shilese JONES' ~ 'Shilese Jones',
  clean_name == 'Karis GERMAN' ~ 'Karis German',
  clean_name == 'Konnor MCCLAIN' ~ 'Konnor McClain',
  clean_name == 'Jade CAREY' ~ 'Jade Carey'
))

m_team_usa <- filter(df_men_c,
                     clean_name == "Brody MALONE"|
                       clean_name == "Javier ALFONSO"|
                       clean_name == "Curran PHILLIPS"|
                       clean_name == "Frederick RICHARD"|
                       clean_name == "Joshua KARNES")

m_team_usa <- m_team_usa %>% mutate(clean_name = case_when (
  clean_name == 'Brody MALONE' ~ 'Brody Malone',
  clean_name == 'Javier ALFONSO' ~ 'Javier Alfonso',
  clean_name == 'Curran PHILLIPS' ~ 'Curran Phillips',
  clean_name == 'Frederick RICHARD' ~ 'Frederick Richard',
  clean_name == 'Joshua KARNES' ~ 'Joshua Karnes'
))
```

```{r range-of-rank-w, fig.cap = "Range of Rank at all Competitions for US Womens Team"}

range_of_rank_w <- ggplot(data = w_team_usa, aes(y= clean_name, x = Rank))+
  geom_point( alpha = .5, color = "#3b4992ff")+
  theme_light()+
  scale_color_aaas()+
  labs(
    x = "Rank",
    y = "Team USA Athletes",
    color = "Competition Scope",
    subtitle = "Women"
  )+
  facet_wrap(.~Apparatus)

```

```{r range-of-rank-m}

range_of_rank_m <- ggplot(data = m_team_usa, aes(y= clean_name, x = Rank))+
  geom_point( alpha = .5, color = "#3b4992ff")+
  theme_light()+
  scale_color_aaas()+
  labs(
    x = "Rank",
    y = "Team USA Athletes", 
    color = "Competition Scope",
    subtitle = "Men"
  )+
  facet_wrap(.~Apparatus)

```
```{r range_of_rank_together, fig.cap = "Every Competition Rank for each team USA Athlete by Apparatus", fig.fullwidth = TRUE}

grid.arrange(range_of_rank_w, range_of_rank_m, nrow = 2)

```



### EDA - separated by type of visualization, not gender, figure out where to put (probably appendix, referenced in methodology)


```{r diff-quali-v-final-vis-women, fig.cap="Distribution of the Difficulty Score by Round and Apparatus for Women"}

women_boxplot_temp <- filter(df_women_c, Round == "final" | Round == "qual")

ggplot(data = women_boxplot_temp, aes(y = Score, fill = Round))+
  geom_boxplot()+
  facet_wrap(.~Apparatus) +
  theme_light()+
  scale_fill_aaas()+  
  labs(
    #title = "Distribution of the Difficulty Score by Round and Apparatus",
   # subtitle = "For Women",
    fill = "Round",
    y = "Score"
  )


```

```{r diff-quali-v-final-vis-men, fig.cap="Distribution of the Difficulty Score by Round and Apparatus for Men"}

men_boxplot_temp <- filter(df_men_c, Round == "final" | Round == "qual")

ggplot(data = men_boxplot_temp, aes(y = Score, fill = Round))+
  geom_boxplot()+
  facet_wrap(.~Apparatus) +
  theme_light()+
  scale_fill_aaas()+  
  labs(
    #title = "Distribution of the Difficulty Score by Round and Apparatus",
   # subtitle = "For men",
    fill = "Round",
    y = "Score"
  )


```

winningmost countries

```{r winningmost-countr-women}

top_countries_women <- filter(df_women_c, 
                              clean_country == "USA"|
                                clean_country == "GBR"|
                                clean_country == "CAN"|
                                clean_country == "CHN"|
                                clean_country == "BRA"|
                                clean_country == "ITA"|
                                clean_country == "NED"|
                                clean_country == "FRA"|
                                clean_country == "JPN"|
                                clean_country == "AUS"|
                                clean_country == "ROU"|
                                clean_country == "KOR"|
                                Round == "TeamFinal")

ggplot(data = top_countries_women, aes(y = clean_country, x = Rank))+
  geom_boxplot()+
  theme_light()+
  labs(
    x = "Rank",
    y = "Country"
  )
```
```{r}
top_countries_men <- filter(df_men_c, 
                              clean_country == "CHN"|
                                clean_country == "JPN"|
                                clean_country == "GBR"|
                                clean_country == "USA"|
                                clean_country == "CAN"|
                                clean_country == "GER"|
                                clean_country == "ITA"|
                                clean_country == "SUI"|
                                clean_country == "ESP"|
                                clean_country == "TUR"|
                                clean_country == "NED"|
                                clean_country == "UKR"|
                              Round == "TeamFinal")

ggplot(data = top_countries_men, aes(y = clean_country, x = Rank))+
  geom_boxplot()+
  theme_light()+
  labs(
    x = "Rank",
    y = "Country"
  ) 
```
showing that most penalties are near 0:
For both men's and women's competitions, the 95th percentile for the penalties is less than 0.5 (it is 0.5 for men and 0.4 for women). This means that 95% of penalties for both genders are not more than 0.5. The visualizations show that this does not change drastically based on the scope of the competition.
Additionally, since the 51st percentile of penalties for both genders is 0.1, this means that the majority of entries had a penalty score of 0.1 or less.
```{r penalty-dist-women, fig.cap="Distribution of Penalties by competition scope for Women"}

# for women
#quantile(as.numeric(df_women_c$Penalty), 0.95, na.rm = TRUE)
#quantile(as.numeric(df_women_c$Penalty), 0.51, na.rm = TRUE)

ggplot(data = df_women_c, aes(x = Penalty)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ competition_scope) +
  labs(title = "Penalty Distribution for Women Athletes",
       x = "Penalty",
       y = "Count") +
  theme_light() +
  scale_color_aaas()

```

```{r penalty-dist-men, fig.cap="Distribution of Penalties by competition scope for Men"}

# for men
#quantile(as.numeric(df_men_c$Penalty), 0.95, na.rm = TRUE)
#quantile(as.numeric(df_men_c$Penalty), 0.51, na.rm = TRUE)

ggplot(data = df_men_c, aes(x = Penalty)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ competition_scope) +
    labs(title = "Penalty Distribution for Men Athletes",
       x = "Penalty",
       y = "Count") +
  theme_light() +
  scale_color_aaas()

```
### Citations
[1] https://www.cnbc.com/2021/08/04/simone-biles-return-helped-olympics-viewership-average-16point8-million.html

[2] https://www.cbssports.com/nba/news/2024-paris-olympics-projecting-team-usas-12-man-roster-with-joel-embiid-joining-lebron-james-stephen-curry/

[3] https://usagym.org/



```{r diff-quali-v-final-vis-women, fig.cap="Distribution of the Difficulty Score by Round and Apparatus for Women"}

women_boxplot_temp <- filter(df_women_c, Round == "final" | Round == "qual")

ggplot(data = women_boxplot_temp, aes(y = Score, fill = Round))+
  geom_boxplot()+
  facet_wrap(.~Apparatus) +
  theme_light()+
  scale_fill_aaas()+  
  labs(
    #title = "Distribution of the Difficulty Score by Round and Apparatus",
   # subtitle = "For Women",
    fill = "Round",
    y = "Score"
  )


```


```{r diff-world-v-nonworld-vis-women, fig.cap="Distribution of Difficulty scores by the Scope of Competition and Apparatus for Women"}

ggplot(data = df_women_c, aes(y = D_Score, fill = competition_scope))+
  geom_boxplot()+
  facet_wrap(.~Apparatus)+
  theme_light()+
  scale_fill_aaas()+
  labs(
    fill = "Competition Scope", 
    y = "Difficulty Score"
  )
```

```{r Score-world-v-nonworld-vis-women, fig.cap="Distribution of Scores by Scope of Competition and Apparatus for Women"}

ggplot(data = df_women_c, aes(y = Score, fill = competition_scope))+
  geom_boxplot()+
  facet_wrap(.~Apparatus)+
  theme_light()+
  scale_fill_aaas()+
  labs(
    fill = "Competition Scope"
  )
```

showing that most penalties are near 0:
For both men's and women's competitions, the 95th percentile for the penalties is less than 0.5 (it is 0.5 for men and 0.4 for women). This means that 95% of penalties for both genders are not more than 0.5. The visualizations show that this does not change drastically based on the scope of the competition.
Additionally, since the 51st percentile of penalties for both genders is 0.1, this means that the majority of entries had a penalty score of 0.1 or less.
```{r penalty-dist-women, fig.cap="Distribution of Penalties by competition scope for Women"}

# for women
#quantile(as.numeric(df_women_c$Penalty), 0.95, na.rm = TRUE)
#quantile(as.numeric(df_women_c$Penalty), 0.51, na.rm = TRUE)

ggplot(data = df_women_c, aes(x = Penalty)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ competition_scope) +
  labs(title = "Penalty Distribution for Women Athletes",
       x = "Penalty",
       y = "Count") +
  theme_light() +
  scale_color_aaas()

```

```{r penalty-dist-men, fig.cap="Distribution of Penalties by competition scope for Men"}

# for men
#quantile(as.numeric(df_men_c$Penalty), 0.95, na.rm = TRUE)
#quantile(as.numeric(df_men_c$Penalty), 0.51, na.rm = TRUE)

ggplot(data = df_men_c, aes(x = Penalty)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ competition_scope) +
    labs(title = "Penalty Distribution for Men Athletes",
       x = "Penalty",
       y = "Count") +
  theme_light() +
  scale_color_aaas()

```

Why we're using mean for bootstrapping:
The distribution of event scores for women and men are both approximately normally distributed, with the mean and median scores less than 0.5 apart within each gender. 
The mean of women's scores is 12.207, and the median of women's scores is 12.367.
The mean of men's scores is 13.048, and the median of men's scores is 13.233.

```{r score-dist-women, fig.cap="Score Distribution for Women Athletes"}
ggplot(data = df_women_c, aes(x = Score)) +
  geom_histogram() +
  labs(title = "Score Distribution for Women Athletes",
       x = "Score",
       y = "Count") +
  theme_light() +
  scale_color_aaas()


#mean(df_women_c$Score)
#median(df_women_c$Score)

```

```{r score-dist-men, fig.cap="Score Distribution for Male Athletes"}

ggplot(data = df_men_c, aes(x = Score)) +
  geom_histogram() +
  labs(title = "Score Distribution for Men Athletes",
       x = "Score",
       y = "Count") +
  theme_light() +
  scale_color_aaas()

#mean(df_men_c$Score)
#median(df_men_c$Score)

```


Whether scores vary by type of round in competition:
Doesn't seem to vary much; make the assumption that qualification scores are representative of an athlete's scores in the medal rounds

```{r}
ggplot(data = df_women_c, aes(x = Score)) +
  geom_histogram(aes(fill = Round)) +
  labs(title = "Score Distribution for Women Athletes, by Round",
       x = "Score",
       y = "Count")

ggplot(data = df_men_c, aes(x = Score)) +
  geom_histogram(aes(fill = Round)) +
  labs(title = "Score Distribution for Men Athletes, by Round",
       x = "Score",
       y = "Count")

mean(df_women_c$Score)
median(df_women_c$Score)

mean(df_men_c$Score)
median(df_men_c$Score)
```

Execution scores have a higher range than difficulty scores, for both men and women athletes (colored by round but doesn't seem to be much difference based on round):





```{r diff-quali-v-final-vis-men, fig.cap="Distribution of the Difficulty Score by Round and Apparatus for Men"}

ggplot(data = df_men_c, aes(y = D_Score, fill = Round))+
  geom_boxplot()+
  facet_wrap(.~Apparatus) +
  theme_light()+
  scale_fill_aaas()+  
  labs(
   # title = "Distribution of the Difficulty Score by Round and Apparatus",
   # subtitle = "For Men",
    fill = "Round",
    y = "Difficulty Score"
  )


```
Waiting for competition scope for men
```{r diff-world-v-nonworld-vis-men, fig.cap="Distribution of Difficulty scores by the Scope of Competition and Apparatus for Men"}

ggplot(data = df_men_c, aes(y = D_Score, fill = competition_scope))+
  geom_boxplot()+
  facet_wrap(.~Apparatus)+
  theme_light()+
  scale_fill_aaas()+
  labs(
    #title = "Distribution of Difficulty scores by the Scope of Competition and Apparatus",
    #subtitle = "For Men",
    fill = "Competition Scope",
    y = "Difficulty Score"
  )
```



```{r Score-world-v-nonworld-vis-men, fig.cap="Distribution of Scores by Scope of Competition and Apparatus for Men"}

ggplot(data = df_men_c, aes(y = Score, fill = competition_scope))+
  geom_boxplot()+
  facet_wrap(.~Apparatus)+
  theme_light()+
  scale_fill_aaas()+
  labs(
   # title = "Distribution of Scores by Scope of Competition and Apparatus",
   # subtitle = "For Men",
    fill = "Competition Scope"
  )

```



